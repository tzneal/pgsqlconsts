
pgsqlconsts
===========

pgsqlconsts is used to parse SQL and generate anonymous structs that contain
table/column names. These can then be used in code to prevent typos, and if used
in CI, ensure that any SQL changes without corresponding code changes result in
compile failures.

Note: This is just an experiment for now, I haven't actually tried to use it yet.

Install
========

```go get -u github.com/tzneal/pgsqlconsts```

Usage
=====

```
Usage: ./pgsqlconsts [OPTION]... [SQLFILE]
  -output string
      if specified, file to write generated code to (default stdout)
  -package string
      package name (default "models")
  -tables string
      comma separated list of tables to generate (default all tables)
```

Example Generated Code
=======================

```sql
CREATE TABLE films (
    code        char(5) CONSTRAINT firstkey PRIMARY KEY,
    title       varchar(40) NOT NULL,
    did         integer NOT NULL,
    date_prod   date,
    kind        varchar(10),
    len         interval hour to minute
);
```

```sh
$ ./pgsqlconsts -output dbconsts.go films.sql 
```

```go
// Code generated by go sqlconsts; DO NOT EDIT.
package models

// Films contains constants for the films table
var Films = struct {
  TableName string
  Code      string // pg_catalog bpchar
  Title     string // pg_catalog varchar
  Did       string // pg_catalog int4
  DateProd  string // date
  Kind      string // pg_catalog varchar
  Len       string // pg_catalog interval
}{"films", "code", "title", "did", "date_prod", "kind", "len"}
```

This can then be used with something like [squirrel](https://github.com/Masterminds/squirrel):

```go
  stmt := sq.Select(models.Films.Code, models.Films.Title).From(models.Films.TableName).
    Where(sq.Eq{models.Films.Did: 25})
  sql, _, _ := stmt.ToSql()
  fmt.Println(sql)
  //Output: 
  // SELECT code, title FROM films WHERE did = ?
  ```